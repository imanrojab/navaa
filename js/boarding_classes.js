// Sample data for classes
const classData = [
  {
    id: 1,
    name: "VII A",
    level: "SMP",
    grade: "VII",
    batch: "Jadid",
    major: "-",
    studentCount: 25,
    homeroom: {
      id: 1,
      name: "Ahmad Fauzi, S.Pd",
      subject: "Matematika",
      photo: "https://randomuser.me/api/portraits/men/32.jpg",
    },
    room: "A101",
    students: [
      {
        id: 1,
        name: "Abdullah Malik",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/1.jpg",
      },
      {
        id: 2,
        name: "Muhammad Rizki",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/2.jpg",
      },
      {
        id: 3,
        name: "Ahmad Fauzan",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/3.jpg",
      },
      {
        id: 4,
        name: "Budi Santoso",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/4.jpg",
      },
      {
        id: 5,
        name: "Dimas Pratama",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/5.jpg",
      },
    ],
  },
  {
    id: 2,
    name: "VII B",
    level: "SMP",
    grade: "VII",
    batch: "Jadid",
    major: "-",
    studentCount: 23,
    homeroom: {
      id: 2,
      name: "Siti Nurhaliza, S.Pd",
      subject: "Bahasa Indonesia",
      photo: "https://randomuser.me/api/portraits/women/32.jpg",
    },
    room: "A102",
    students: [
      {
        id: 6,
        name: "Eko Prasetyo",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/6.jpg",
      },
      {
        id: 7,
        name: "Fajar Nugroho",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/7.jpg",
      },
      {
        id: 8,
        name: "Gunawan Wibisono",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/8.jpg",
      },
      {
        id: 9,
        name: "Hendra Wijaya",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/9.jpg",
      },
      {
        id: 10,
        name: "Irfan Hakim",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/10.jpg",
      },
    ],
  },
  {
    id: 3,
    name: "X IPA 1",
    level: "SMA",
    grade: "X",
    batch: "Jadid",
    major: "IPA",
    studentCount: 30,
    homeroom: {
      id: 3,
      name: "Budi Santoso, S.Pd",
      subject: "Fisika",
      photo: "https://randomuser.me/api/portraits/men/33.jpg",
    },
    room: "B101",
    students: [
      {
        id: 11,
        name: "Joko Widodo",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/11.jpg",
      },
      {
        id: 12,
        name: "Kurniawan",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/12.jpg",
      },
      {
        id: 13,
        name: "Lukman Hakim",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/13.jpg",
      },
      {
        id: 14,
        name: "Muhamad Anwar",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/14.jpg",
      },
      {
        id: 15,
        name: "Nugroho Prasetyo",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/15.jpg",
      },
    ],
  },
  {
    id: 4,
    name: "X IPA 2",
    level: "SMA",
    grade: "X",
    batch: "Jadid",
    major: "IPA",
    studentCount: 28,
    homeroom: {
      id: 4,
      name: "Dewi Lestari, S.Pd",
      subject: "Biologi",
      photo: "https://randomuser.me/api/portraits/women/33.jpg",
    },
    room: "B102",
    students: [
      {
        id: 16,
        name: "Oktavianus",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/16.jpg",
      },
      {
        id: 17,
        name: "Prabowo",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/17.jpg",
      },
      {
        id: 18,
        name: "Qomar Zaman",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/18.jpg",
      },
      {
        id: 19,
        name: "Rahmat Hidayat",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/19.jpg",
      },
      {
        id: 20,
        name: "Surya Darma",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/20.jpg",
      },
    ],
  },
  {
    id: 5,
    name: "X IPS 1",
    level: "SMA",
    grade: "X",
    batch: "Jadid",
    major: "IPS",
    studentCount: 27,
    homeroom: {
      id: 5,
      name: "Eko Prasetyo, S.Pd",
      subject: "Ekonomi",
      photo: "https://randomuser.me/api/portraits/men/34.jpg",
    },
    room: "B103",
    students: [
      {
        id: 21,
        name: "Taufik Hidayat",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/21.jpg",
      },
      {
        id: 22,
        name: "Umar Zein",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/22.jpg",
      },
      {
        id: 23,
        name: "Vino Bastian",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/23.jpg",
      },
      {
        id: 24,
        name: "Wahyu Agung",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/24.jpg",
      },
      {
        id: 25,
        name: "Xaverius Aditya",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/25.jpg",
      },
    ],
  },
  {
    id: 6,
    name: "XI TKJ 1",
    level: "SMK",
    grade: "XI",
    batch: "Kodim",
    major: "TKJ",
    studentCount: 24,
    homeroom: {
      id: 6,
      name: "Fitriani, S.Pd",
      subject: "Komputer Jaringan",
      photo: "https://randomuser.me/api/portraits/women/34.jpg",
    },
    room: "C101",
    students: [
      {
        id: 26,
        name: "Yusuf Islam",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/26.jpg",
      },
      {
        id: 27,
        name: "Zaenal Abidin",
        gender: "Laki-laki",
        photo: "https://randomuser.me/api/portraits/men/27.jpg",
      },
      {
        id: 28,
        name: "Aisyah Putri",
        gender: "Perempuan",
        photo: "https://randomuser.me/api/portraits/women/1.jpg",
      },
      {
        id: 29,
        name: "Bunga Citra",
        gender: "Perempuan",
        photo: "https://randomuser.me/api/portraits/women/2.jpg",
      },
      {
        id: 30,
        name: "Citra Dewi",
        gender: "Perempuan",
        photo: "https://randomuser.me/api/portraits/women/3.jpg",
      },
    ],
  },
];

let currentStudentClassId = null;

// Initialize the page
document.addEventListener("DOMContentLoaded", function () {
  populateClassesTable();
  populateStudentsTable();
  populateClassOptions();
  setupFileUpload();
});

// Switch between tabs
function switchTab(tab) {
  const tabLinks = document.querySelectorAll(".inline-block");
  const tabContents = document.querySelectorAll(".tab-content");

  tabLinks.forEach((link) => {
    link.classList.remove("tab-active");
    link.classList.add("text-gray-500");
    link.classList.remove("text-indigo-600");
  });

  tabContents.forEach((content) => {
    content.classList.add("hidden");
  });

  const selectedTabLink = document.querySelector(
    `[onclick="switchTab('${tab}')"]`
  );
  selectedTabLink.classList.add("tab-active");
  selectedTabLink.classList.remove("text-gray-500");
  selectedTabLink.classList.add("text-indigo-600");

  document.getElementById(`${tab}-tab`).classList.remove("hidden");
}

// Populate classes table
function populateClassesTable() {
  const tableBody = document.getElementById("classes-table");
  tableBody.innerHTML = "";

  classData.forEach((cls) => {
    const row = document.createElement("tr");
    const levelBadgeClass =
      cls.level === "SMP"
        ? "badge-smp"
        : cls.level === "SMA"
        ? "badge-sma"
        : "badge-smk";

    row.innerHTML = `
               <td class="px-4 py-4 whitespace-nowrap">
                   <div class="flex items-center">
                       <div class="flex-shrink-0 h-8 w-8 bg-${
                         cls.level === "SMP"
                           ? "green"
                           : cls.level === "SMA"
                           ? "blue"
                           : "yellow"
                       }-500 rounded-full flex items-center justify-center text-white">
                           <i class="fas fa-chalkboard"></i>
                       </div>
                       <div class="ml-3">
                           <p class="text-sm font-medium text-gray-900">${
                             cls.name
                           }</p>
                       </div>
                   </div>
               </td>
               <td class="px-4 py-4 whitespace-nowrap">
                   <span class="badge ${levelBadgeClass}">${cls.level}</span>
               </td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 cls.grade
               }</td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 cls.batch
               }</td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 cls.major
               }</td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 cls.studentCount
               }</td>
               <td class="px-4 py-4 whitespace-nowrap">
                   <div class="flex items-center">
                       <div class="flex-shrink-0 h-6 w-6">
                           <img class="h-6 w-6 rounded-full" src="${
                             cls.homeroom.photo
                           }" alt="${cls.homeroom.name}">
                       </div>
                       <div class="ml-2">
                           <p class="text-sm text-gray-900">${
                             cls.homeroom.name
                           }</p>
                       </div>
                   </div>
               </td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 cls.room
               }</td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                   <div class="flex space-x-2">
                       <button onclick="showClassDetail(${
                         cls.id
                       })" class="text-indigo-600 hover:text-indigo-900 tooltip">
                           <i class="fas fa-eye"></i>
                           <span class="tooltip-text">Lihat Detail</span>
                       </button>
                       <button onclick="showEditClassModal(${
                         cls.id
                       })" class="text-green-600 hover:text-green-900 tooltip">
                           <i class="fas fa-edit"></i>
                           <span class="tooltip-text">Edit</span>
                       </button>
                   </div>
               </td>
           `;

    tableBody.appendChild(row);
  });
}

// Populate students table
function populateStudentsTable() {
  const tableBody = document.getElementById("students-table");
  tableBody.innerHTML = "";

  let allStudents = [];
  classData.forEach((cls) => {
    cls.students.forEach((student) => {
      allStudents.push({
        ...student,
        className: cls.name,
        classId: cls.id,
        level: cls.level,
        grade: cls.grade,
        major: cls.major,
      });
    });
  });

  allStudents.sort((a, b) => a.name.localeCompare(b.name));

  allStudents.forEach((student, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${
                 index + 1
               }</td>
               <td class="px-4 py-4 whitespace-nowrap">
                   <div class="flex items-center">
                       <div class="flex-shrink-0 h-8 w-8">
                           <img class="h-8 w-8 rounded-full" src="${
                             student.photo
                           }" alt="${student.name}">
                       </div>
                       <div class="ml-3">
                           <p class="text-sm font-medium text-gray-900">${
                             student.name
                           }</p>
                       </div>
                   </div>
               </td>
               <td class="px-4 py-4 whitespace-nowrap">
                   <div class="flex items-center">
                       <div class="flex-shrink-0 h-6 w-6 bg-${
                         student.level === "SMP"
                           ? "green"
                           : student.level === "SMA"
                           ? "blue"
                           : "yellow"
                       }-500 rounded-full flex items-center justify-center text-white text-xs">
                           <i class="fas fa-chalkboard"></i>
                       </div>
                       <div class="ml-2">
                           <p class="text-sm text-gray-900">${
                             student.className
                           }</p>
                           <p class="text-xs text-gray-500">${student.level} ${
      student.major !== "-" ? student.major : ""
    }</p>
                       </div>
                   </div>
               </td>
               <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                   <button onclick="showStudentDetail(${
                     student.id
                   })" class="text-indigo-600 hover:text-indigo-900 tooltip">
                       <i class="fas fa-user"></i>
                       <span class="tooltip-text">Detail Siswa</span>
                   </button>
               </td>
           `;

    tableBody.appendChild(row);
  });
}

// Populate class options for student filter
function populateClassOptions() {
  const classSelect = document.getElementById("student-class-filter");

  classSelect.innerHTML = '<option value="">Semua Kelas</option>';

  classData.forEach((cls) => {
    const option = document.createElement("option");
    option.value = cls.id;
    option.textContent = `${cls.name} (${cls.level})`;
    classSelect.appendChild(option);
  });
}

// Update form options based on selected level
function updateFormOptions() {
  const level = document.getElementById("form-level").value;
  const gradeSelect = document.getElementById("form-grade");
  const majorSelect = document.getElementById("form-major");

  // Clear previous options
  gradeSelect.innerHTML = '<option value="">Pilih Kelas</option>';
  majorSelect.innerHTML = '<option value="">Pilih Jurusan</option>';

  // Add grade options based on level
  if (level === "SMP") {
    ["VII", "VIII", "IX"].forEach((grade) => {
      const option = document.createElement("option");
      option.value = grade;
      option.textContent = grade;
      gradeSelect.appendChild(option);
    });

    // SMP has no majors
    const option = document.createElement("option");
    option.value = "-";
    option.textContent = "-";
    majorSelect.appendChild(option);
  } else if (level === "SMA") {
    ["X", "XI", "XII"].forEach((grade) => {
      const option = document.createElement("option");
      option.value = grade;
      option.textContent = grade;
      gradeSelect.appendChild(option);
    });

    // SMA majors
    ["IPA", "IPS"].forEach((major) => {
      const option = document.createElement("option");
      option.value = major;
      option.textContent = major;
      majorSelect.appendChild(option);
    });
  } else if (level === "SMK") {
    ["X", "XI", "XII"].forEach((grade) => {
      const option = document.createElement("option");
      option.value = grade;
      option.textContent = grade;
      gradeSelect.appendChild(option);
    });

    // SMK majors
    ["AKUNTANSI", "TKJ", "APHP"].forEach((major) => {
      const option = document.createElement("option");
      option.value = major;
      option.textContent = major;
      majorSelect.appendChild(option);
    });
  }
}

// Show modal
function showModal(modalId) {
  document.getElementById(modalId).style.display = "block";
}

// Close modal
function closeModal(modalId) {
  document.getElementById(modalId).style.display = "none";
}

// Show class detail
function showClassDetail(id) {
  const cls = classData.find((c) => c.id === id);
  if (!cls) return;

  document.getElementById(
    "detail-class-icon"
  ).className = `w-20 h-20 rounded-full flex items-center justify-center text-white text-3xl mb-3 bg-${
    cls.level === "SMP" ? "green" : cls.level === "SMA" ? "blue" : "yellow"
  }-500`;
  document.getElementById("detail-class-name").textContent = cls.name;

  const levelContainer = document.getElementById(
    "detail-class-level-container"
  );
  let levelBadgeClass =
    cls.level === "SMP"
      ? "badge-smp"
      : cls.level === "SMA"
      ? "badge-sma"
      : "badge-smk";
  levelContainer.innerHTML = `<span class="badge ${levelBadgeClass}">${cls.level}</span>`;

  document.getElementById("detail-class-grade").textContent = cls.grade;
  document.getElementById("detail-class-batch").textContent = cls.batch;
  document.getElementById("detail-class-major").textContent = cls.major;
  document.getElementById("detail-class-room").textContent = cls.room;
  document.getElementById("detail-class-student-count").textContent =
    cls.studentCount;

  document.getElementById("detail-homeroom-photo").src = cls.homeroom.photo;
  document.getElementById("detail-homeroom-name").textContent =
    cls.homeroom.name;
  document.getElementById("detail-homeroom-subject").textContent =
    cls.homeroom.subject;

  const studentsTable = document.getElementById("detail-students-table");
  studentsTable.innerHTML = "";

  cls.students.forEach((student, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
               <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">${
                 index + 1
               }</td>
               <td class="px-3 py-2 whitespace-nowrap">
                   <div class="flex items-center">
                       <div class="flex-shrink-0 h-7 w-7">
                           <img class="h-7 w-7 rounded-full" src="${
                             student.photo
                           }" alt="${student.name}">
                       </div>
                       <div class="ml-2">
                           <p class="text-sm font-medium text-gray-900">${
                             student.name
                           }</p>
                       </div>
                   </div>
               </td>
               <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">${
                 student.gender
               }</td>
               <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">
                   <button onclick="showStudentDetail(${
                     student.id
                   })" class="text-indigo-600 hover:text-indigo-900">
                       <i class="fas fa-user"></i>
                   </button>
               </td>
           `;

    studentsTable.appendChild(row);
  });

  showModal("classDetailModal");
}

// Show student detail
function showStudentDetail(id) {
  let student = null;
  let studentClass = null;

  for (const cls of classData) {
    const foundStudent = cls.students.find((s) => s.id === id);
    if (foundStudent) {
      student = foundStudent;
      studentClass = cls;
      break;
    }
  }

  if (!student) return;

  currentStudentClassId = studentClass.id;

  document.getElementById("detail-student-photo").src = student.photo;
  document.getElementById("detail-student-name").textContent = student.name;
  document.getElementById("detail-student-id").textContent = `NIS: ${
    100000 + student.id
  }`;
  document.getElementById("detail-student-gender").textContent = student.gender;
  document.getElementById("detail-student-birthdate").textContent =
    "15 Januari 2005";
  document.getElementById("detail-student-address").textContent =
    "Jl. Merdeka No. 123, Jakarta";
  document.getElementById("detail-student-parent").textContent =
    "Bapak Suparman / Ibu Suparti";
  document.getElementById("detail-student-phone").textContent = "081234567890";

  document.getElementById(
    "detail-student-class-icon"
  ).className = `w-12 h-12 rounded-full flex items-center justify-center text-white text-xl mr-4 bg-${
    studentClass.level === "SMP"
      ? "green"
      : studentClass.level === "SMA"
      ? "blue"
      : "yellow"
  }-500`;
  document.getElementById("detail-student-class-name").textContent =
    studentClass.name;

  const classLevelBadge = document.getElementById("detail-student-class-level");
  classLevelBadge.className = `badge ${
    studentClass.level === "SMP"
      ? "badge-smp"
      : studentClass.level === "SMA"
      ? "badge-sma"
      : "badge-smk"
  }`;
  classLevelBadge.textContent = studentClass.level;

  document.getElementById("detail-student-class-info").textContent = `${
    studentClass.grade
  } | ${studentClass.major !== "-" ? studentClass.major : ""} | ${
    studentClass.batch
  }`;

  // Sample dorm data
  const dormType = student.gender === "Laki-laki" ? "putra" : "putri";
  document.getElementById(
    "detail-student-dorm-icon"
  ).className = `w-12 h-12 rounded-full flex items-center justify-center text-white text-xl mr-4 bg-${
    dormType === "putra" ? "blue" : "pink"
  }-500`;
  document.getElementById("detail-student-dorm-name").textContent =
    dormType === "putra" ? "Al-Farabi A1" : "Fatimah D1";
  document.getElementById("detail-student-dorm-building").textContent =
    dormType === "putra" ? "Gedung A, Lantai 1" : "Gedung D, Lantai 1";

  const dormTypeBadge = document.getElementById("detail-student-dorm-type");
  dormTypeBadge.className = `badge ${
    dormType === "putra"
      ? "bg-blue-100 text-blue-800"
      : "bg-pink-100 text-pink-800"
  }`;
  dormTypeBadge.textContent = dormType === "putra" ? "Putra" : "Putri";

  showModal("studentDetailModal");
}

// Show edit class modal
function showEditClassModal(id) {
  const cls = classData.find((c) => c.id === id);
  if (!cls) return;

  document.getElementById("class-modal-title").textContent = "Edit Kelas";
  document.getElementById("form-class-name").value = cls.name;
  document.getElementById("form-level").value = cls.level;

  updateFormOptions();

  document.getElementById("form-grade").value = cls.grade;
  document.getElementById("form-batch").value = cls.batch;
  document.getElementById("form-major").value = cls.major;
  document.getElementById("form-room").value = cls.room;

  // Find homeroom id
  const homeroomSelect = document.getElementById("form-homeroom");
  for (let i = 0; i < homeroomSelect.options.length; i++) {
    if (homeroomSelect.options[i].text === cls.homeroom.name) {
      homeroomSelect.selectedIndex = i;
      break;
    }
  }

  showModal("classModal");
}

// Save class (add or edit)
function saveClass() {
  const name = document.getElementById("form-class-name").value;
  const level = document.getElementById("form-level").value;
  const grade = document.getElementById("form-grade").value;
  const batch = document.getElementById("form-batch").value;
  const major = document.getElementById("form-major").value;
  const room = document.getElementById("form-room").value;
  const homeroomSelect = document.getElementById("form-homeroom");
  const homeroom = homeroomSelect.options[homeroomSelect.selectedIndex].text;

  if (!name || !level || !grade || !batch || !major || !room || !homeroom) {
    showNotification("Mohon lengkapi semua field yang diperlukan", "error");
    return;
  }

  const isEdit =
    document.getElementById("class-modal-title").textContent === "Edit Kelas";

  if (isEdit) {
    // Update existing class logic would go here
    showNotification("Kelas berhasil diperbarui", "success");
  } else {
    // Add new class logic would go here
    showNotification("Kelas baru berhasil ditambahkan", "success");
  }

  closeModal("classModal");
  populateClassesTable();
  populateStudentsTable();
  populateClassOptions();
}

// Apply filters
function applyFilters(type) {
  if (type === "classes") {
    const levelFilter = document.getElementById("level-filter").value;
    const gradeFilter = document.getElementById("grade-filter").value;
    const batchFilter = document.getElementById("batch-filter").value;
    const majorFilter = document.getElementById("major-filter").value;

    // Filter logic would go here
    showNotification("Filter diterapkan", "success");
  } else {
    const nameFilter = document
      .getElementById("student-name-filter")
      .value.toLowerCase();
    const classFilter = document.getElementById("student-class-filter").value;
    const levelFilter = document.getElementById("student-level-filter").value;

    // Filter logic would go here
    showNotification("Filter diterapkan", "success");
  }
}

// Export data
function exportData(type) {
  if (type === "classes") {
    showNotification("Data kelas berhasil diekspor", "success");
  } else {
    showNotification("Data siswa berhasil diekspor", "success");
  }
}

// Export class students
function exportClassStudents() {
  showNotification("Data siswa kelas berhasil diekspor", "success");
}

// Import data
function importData() {
  showModal("importModal");
}

// Process import
function processImport() {
  const fileInput = document.getElementById("import-file");
  if (!fileInput.files || fileInput.files.length === 0) {
    showNotification("Silakan pilih file terlebih dahulu", "error");
    return;
  }

  // Import logic would go here
  showNotification("Data berhasil diimport", "success");
  closeModal("importModal");
}

// Setup file upload
function setupFileUpload() {
  const fileInput = document.getElementById("import-file");
  const fileContainer = document.getElementById("selected-file-container");
  const fileName = document.getElementById("selected-file-name");

  fileInput.addEventListener("change", function () {
    if (this.files && this.files.length > 0) {
      fileName.textContent = this.files[0].name;
      fileContainer.classList.remove("hidden");
    } else {
      fileContainer.classList.add("hidden");
    }
  });
}

// Remove selected file
function removeSelectedFile() {
  const fileInput = document.getElementById("import-file");
  const fileContainer = document.getElementById("selected-file-container");

  fileInput.value = "";
  fileContainer.classList.add("hidden");
}

// Show notification
function showNotification(message, type = "success") {
  const notification = document.getElementById("notification");
  const notificationMessage = document.getElementById("notification-message");

  notification.className = `notification ${
    type === "success" ? "bg-green-600" : "bg-red-600"
  } text-white`;
  notificationMessage.textContent = message;

  notification.classList.add("show");

  setTimeout(() => {
    notification.classList.remove("show");
  }, 3000);
}

(function () {
  function c() {
    var b = a.contentDocument || a.contentWindow.document;
    if (b) {
      var d = b.createElement("script");
      d.innerHTML =
        "window.__CF$cv$params={r:'9416d48372a8ce72',t:'MTc0NzUyMzg2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
      b.getElementsByTagName("head")[0].appendChild(d);
    }
  }
  if (document.body) {
    var a = document.createElement("iframe");
    a.height = 1;
    a.width = 1;
    a.style.position = "absolute";
    a.style.top = 0;
    a.style.left = 0;
    a.style.border = "none";
    a.style.visibility = "hidden";
    document.body.appendChild(a);
    if ("loading" !== document.readyState) c();
    else if (window.addEventListener)
      document.addEventListener("DOMContentLoaded", c);
    else {
      var e = document.onreadystatechange || function () {};
      document.onreadystatechange = function (b) {
        e(b);
        "loading" !== document.readyState &&
          ((document.onreadystatechange = e), c());
      };
    }
  }
})();

// Update current date and time
function updateDateTime() {
  const now = new Date();
  const options = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
  };
  document.getElementById("current-datetime").textContent =
    now.toLocaleDateString("id-ID", options);
}

updateDateTime();
setInterval(updateDateTime, 60000); // Update every minute

// Toggle sidebar on mobile
document
  .getElementById("sidebar-toggle")
  .addEventListener("click", function () {
    document.getElementById("sidebar").classList.toggle("open");
  });

// Toggle submenu
function toggleSubmenu(id) {
  const submenu = document.getElementById(id);
  const icon = document.getElementById(id.split("-")[0] + "-icon");

  if (submenu.classList.contains("active")) {
    submenu.classList.remove("active");
    icon.style.transform = "rotate(0deg)";
  } else {
    submenu.classList.add("active");
    icon.style.transform = "rotate(180deg)";
  }
}
// Toggle profile dropdown
document
  .getElementById("profile-menu-button")
  .addEventListener("click", function () {
    document.getElementById("profile-dropdown").classList.toggle("show");
  });

// Close dropdown when clicking outside
window.addEventListener("click", function (event) {
  if (!event.target.closest("#profile-menu-button")) {
    const dropdown = document.getElementById("profile-dropdown");
    if (dropdown.classList.contains("show")) {
      dropdown.classList.remove("show");
    }
  }

  // Close action dropdowns when clicking outside
  if (!event.target.closest(".action-button")) {
    const actionDropdowns = document.querySelectorAll(".action-dropdown");
    actionDropdowns.forEach((dropdown) => {
      if (dropdown.classList.contains("show")) {
        dropdown.classList.remove("show");
      }
    });
  }
});
